https://wokwi.com/projects/448661233234617345

#include <stdio.h>
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "driver/ledc.h"

#define LEDC_TIMER      LEDC_TIMER_0
#define LEDC_MODE       LEDC_HIGH_SPEED_MODE

#define LEDC_GPIO_R     33
#define LEDC_CHANNEL_R  LEDC_CHANNEL_0
#define LEDC_GPIO_G     25
#define LEDC_CHANNEL_G  LEDC_CHANNEL_1
#define LEDC_GPIO_B     26
#define LEDC_CHANNEL_B  LEDC_CHANNEL_2

#define LEDC_DUTY_RES   LEDC_TIMER_13_BIT
#define LEDC_FREQUENCY  5000

#define RGB_TO_DUTY(x) ((x) * ((1 << LEDC_DUTY_RES) - 1) / 255)

// Цвета: {R, G, B}
uint8_t colors[3] = {255,   0,   0};

void update_colors(uint8_t step) {
    // R->G
    if (colors[0] == 255 && colors[1] < 255 && colors[2] == 0) colors[1] += step;
    // G->R
    else if (colors[1] == 255 && colors[0] > 0 && colors[2] == 0) colors[0] -= step;
    // G->B
    else if (colors[1] == 255 && colors[0] == 0 && colors[2] < 255) colors[2] += step;
    // B->G
    else if (colors[2] == 255 && colors[1] > 0 && colors[0] == 0) colors[1] -= step;
    // B->R
    else if (colors[2] == 255 && colors[0] < 255 && colors[1] == 0) colors[0] += step;
    // R->B
    else if (colors[0] == 255 && colors[2] > 0 && colors[1] == 0) colors[2] -= step;
}

// Массив каналов и GPIO
const ledc_channel_t channels[] = {LEDC_CHANNEL_R, LEDC_CHANNEL_G, LEDC_CHANNEL_B};
const gpio_num_t gpios[] = {LEDC_GPIO_R, LEDC_GPIO_G, LEDC_GPIO_B};

void app_main(void)
{
    // Настройка таймера
    ledc_timer_config_t timer_conf = {
        .duty_resolution = LEDC_DUTY_RES,
        .freq_hz = LEDC_FREQUENCY,
        .speed_mode = LEDC_MODE,
        .timer_num = LEDC_TIMER,
        .clk_cfg = LEDC_AUTO_CLK
    };
    ledc_timer_config(&timer_conf);

    // Настройка каналов
    for (int i = 0; i < 3; i++) {
        ledc_channel_config_t ch_cfg = {
            .channel = channels[i],
            .duty = 0,
            .gpio_num = gpios[i],
            .speed_mode = LEDC_MODE,
            .hpoint = 0,
            .timer_sel = LEDC_TIMER,
            .flags.output_invert = 0
        };
        ledc_channel_config(&ch_cfg);
    }
    while (1) {
        // Установка всех каналов через цикл — рефакторинг
        for (int i = 0; i < 3; i++) {
            ledc_set_duty(LEDC_MODE, channels[i], RGB_TO_DUTY(colors[i]));
            ledc_update_duty(LEDC_MODE, channels[i]);
        }

        update_colors(5);

        vTaskDelay(pdMS_TO_TICKS(10)); // задержка между цветами
    }
}
>>>>>>> f3fae038678be8112b49e50354655c3822e7726a
